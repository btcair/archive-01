
# VPC NACL (Network Access Control List)

## 1. 개요
VPC 내의 **서브넷(Subnet) 경계에서 트래픽이 들어오고 나가는 것을 제어**하는 추가적인 보안 계층(방화벽)입니다. 보안 그룹(Security Group)과 함께 다중 방어(Defense in Depth)를 구성합니다.

## 2. 설명
* **적용 단위:** 인스턴스(ENI) 단위가 아닌 **서브넷(Subnet)** 단위로 적용됩니다.
* **Stateless (상태 비저장):**
  * 들어오는 요청(Inbound) 트래픽을 허용했다고 해서 나가는 응답(Outbound) 트래픽이 자동으로 허용되지 않습니다. 반드시 **인바운드와 아웃바운드 규칙을 각각 명시적으로 허용**해야 통신이 성립됩니다.
* **규칙 평가 순서:**
  * 가장 낮은 번호(예: 100)의 규칙부터 순서대로 평가되며, 조건에 일치하는 첫 번째 규칙이 적용됩니다. 허용(Allow)과 거부(Deny)를 조합하여 유연하게 설정할 수 있습니다.



## 3. 참조 및 관련된 파일
* [[vpc-design-best-practice]]
* [[vpc-flog-log]] (NACL 차단 이력 추적)

## 4. 트러블 슈팅
* **인바운드 포트를 열었는데도 통신이 안 됨 (가장 흔한 실수):**
  * 예를 들어 웹 서버용 서브넷 NACL 인바운드에서 TCP 80(HTTP)을 열어주더라도, 클라이언트에게 응답을 되돌려주려면 **아웃바운드에서 '임시 포트 범위(Ephemeral Ports)'를 허용**해 주어야 합니다.
  * (임시 포트 범위: Linux는 보통 `32768-61000`, Windows는 `49152-65535`, AWS NAT Gateway는 `1024-65535`).
* **모든 트래픽 차단 현상:**
  * 서브넷은 반드시 하나의 NACL과 연결되어야 합니다. 사용자가 만든 NACL을 서브넷에 연결했는데 그 안에 기본 허용 규칙(Rule * 별표) 외에 명시적인 허용 규칙이 없다면 모든 통신이 끊어집니다.

## 5. 참고자료 또는 링크
* [AWS 공식 문서 - 서브넷 트래픽 제어를 위한 네트워크 ACL](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html)